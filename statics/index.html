<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Protected Index Page</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
<h1>Welcome to MQ Usage Dashboard</h1>
<p>This is a protected page that requires login.</p>

<script>
    // Check if token exists and is valid
    const token = localStorage.getItem('access_token');

    function isTokenExpired(token) {
        if (!token) return true;

        try {
            const payloadBase64 = token.split('.')[1];
            const payloadJson = atob(payloadBase64);
            const payload = JSON.parse(payloadJson);
            const now = Math.floor(Date.now() / 1000);

            return payload.exp && payload.exp < now; // true = expired
        } catch (e) {
            return true; // error decoding token
        }
    }

    if (!token || isTokenExpired(token)) {
        // 🔁 redirect to login
        console.log("Token is invalid ❌");
        window.location.href = "/login.html";
    } else {
        console.log("Token is valid ✅");
        // 👉 คุณสามารถเรียก API ที่ต้อง auth ได้ต่อจากนี้
    }
</script>
</body>
</html>