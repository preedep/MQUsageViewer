<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MQ Usage Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
<h1>Welcome to MQ Usage Dashboard</h1>
<p>This is a protected page that requires login.</p>
<button id="logout-btn">Logout</button>

<script>
    // Helper: Check if token is expired
    function isTokenExpired(token) {
        if (!token) return true;
        try {
            const payloadBase64 = token.split('.')[1];
            const payloadJson = atob(payloadBase64);
            const payload = JSON.parse(payloadJson);
            const now = Math.floor(Date.now() / 1000);
            return payload.exp && payload.exp < now;
        } catch (e) {
            return true;
        }
    }

    // Main Auth Check
    const token = localStorage.getItem('access_token');
    if (!token || isTokenExpired(token)) {
        console.warn("Token invalid or expired. Redirecting to login.");
        localStorage.removeItem('access_token');
        window.location.href = "/login.html";
    }

    // Logout
    const logoutBtn = document.getElementById('logout-btn');
    logoutBtn.addEventListener('click', () => {
        localStorage.removeItem('access_token');
        window.location.href = "/login.html";
    });

    // OPTIONAL: Fetch protected data after auth passed
    // fetch('/api/v1/your-api', {
    //     headers: {
    //         'Authorization': `Bearer ${token}`
    //     }
    // }).then(res => res.json()).then(data => {
    //     console.log(data);
    // });
</script>
</body>
</html>